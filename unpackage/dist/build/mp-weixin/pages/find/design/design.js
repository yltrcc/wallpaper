(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/find/design/design"],{"0af4":function(e,n,t){},"1cee":function(e,n,t){"use strict";(function(e){t("acd6");a(t("66fd"));var n=a(t("72f4"));function a(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},5131:function(e,n,t){"use strict";var a=t("0af4"),i=t.n(a);i.a},"72f4":function(e,n,t){"use strict";t.r(n);var a=t("b222"),i=t("e97d");for(var s in i)"default"!==s&&function(e){t.d(n,e,(function(){return i[e]}))}(s);t("5131");var r,u=t("f0c5"),o=Object(u["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],r);n["default"]=o.exports},b222:function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return s})),t.d(n,"a",(function(){return a}));var a={uIcon:function(){return t.e("uview-ui/components/u-icon/u-icon").then(t.bind(null,"df57"))}},i=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.designShow=!1},e.e1=function(n){e.signShow=!1},e.e2=function(n){e.adShow=!1},e.e3=function(n){e.adShow=!1})},s=[]},c277:function(e,n,t){"use strict";(function(e,a){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=s(t("a34a"));function s(e){return e&&e.__esModule?e:{default:e}}function r(e,n,t,a,i,s,r){try{var u=e[s](r),o=u.value}catch(c){return void t(c)}u.done?n(o):Promise.resolve(o).then(a,i)}function u(e){return function(){var n=this,t=arguments;return new Promise((function(a,i){var s=e.apply(n,t);function u(e){r(s,a,i,u,o,"next",e)}function o(e){r(s,a,i,u,o,"throw",e)}u(void 0)}))}}var o=null,c=null,d=function(){t.e("components/model/model").then(function(){return resolve(t("430a"))}.bind(null,t)).catch(t.oe)},l=e.getSystemInfoSync(),f={components:{models:d},data:function(){return{w:l.screenWidth,h:l.screenHeight,loadShow:!0,adIntegral:0,signShow:!1,signTitle:"",designIntegral:0,designShow:!1,designTitle:"",adShow:!1,canvasUrl:"https://vkceyugu.cdn.bspapp.com/VKCEYUGU-7883b0be-568b-405c-83d4-6d4fe8b4df7d/9e2eacac-e3b0-4ac8-8752-d864f1d19ae9.jpg",saveUrl:"",designList:[],designCurrent:0,viewShow:!1}},onReady:function(){var n=this;c=e.createCanvasContext("firstCanvas"),c.width=2*n.w,c.height=2*n.h},onLoad:function(){var e=this;return u(i.default.mark((function n(){var t;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,t.getDesign();case 3:return n.next=5,t.getConfig();case 5:t.adLoad(),t.loadShow=!1;case 7:case"end":return n.stop()}}),n)})))()},methods:{getDesign:function(){var e=this;return u(i.default.mark((function n(){var t,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,a.callFunction({name:"query_list",data:{dbName:"wx_design",order:{name:"time",type:"asc"},pageIndex:1,pageSize:200}});case 3:s=n.sent,t.designList=s.result.data;case 5:case"end":return n.stop()}}),n)})))()},getConfig:function(){var e=this;return u(i.default.mark((function n(){var t,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,a.callFunction({name:"config_map",data:{keys:["designIntegral","adIntegral"]}});case 3:s=n.sent,s.result.success&&(t.designIntegral=parseInt(s.result.data[0]),t.adIntegral=parseInt(s.result.data[1]));case 5:case"end":return n.stop()}}),n)})))()},cheekClick:function(e){var n=this;n.designCurrent!==e&&(n.designCurrent=e)},chooseClick:function(){var n=this;e.chooseImage({count:1,sizeType:["original"],sourceType:["album"],success:function(e){console.log(e),n.canvasUrl=e.tempFilePaths[0]}})},canvasCont:function(){var n=this;return u(i.default.mark((function t(){var s,r,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(s=n,!(s.designIntegral>0&&1===s.designList[s.designCurrent].mode)){t.next=15;break}if(r=s.vuex_user.integral,!(r<s.designIntegral)){t.next=7;break}return s.designShow=!0,s.designTitle="<p style='font-weight: 550;font-size: 16px;'>下载需要 "+s.designIntegral+" 积分</p><p style='padding-top: 10px;'>您当前仅有<span class='num'>"+r+"</span>积分，不足以下载当前刘海壁纸~</p>",t.abrupt("return");case 7:return e.showLoading({mask:!0,title:"保存中..."}),t.next=10,a.callFunction({name:"place_design",data:{userId:s.vuex_user._id}});case 10:if(u=t.sent,u.result.success){t.next=14;break}return e.showToast({mask:!0,icon:"none",title:u.result.msg,duration:1e3}),t.abrupt("return");case 14:s.getUser();case 15:e.showLoading({mask:!0,title:"保存中..."}),e.getImageInfo({src:s.canvasUrl,success:function(n){var t=s.imageUtil(n.width,n.height),a=n.path;e.downloadFile({url:s.designList[s.designCurrent].image,success:function(n){var i=n.tempFilePath;c.drawImage(a,2*t.x,2*t.y,2*t.width,2*t.height),c.drawImage(i,0,0,2*s.w,2*s.w),c.draw(),setTimeout((function(){e.canvasToTempFilePath({fileType:"jpg",canvasId:"firstCanvas",success:function(e){s.saveImage(e.tempFilePath)}})}),300)}})}});case 17:case"end":return t.stop()}}),t)})))()},saveImage:function(n){var t=this;e.saveImageToPhotosAlbum({filePath:n,success:function(n){e.hideLoading(),t.adShow=!0},fail:function(n){n.errMsg&&e.showModal({title:"提示",content:"无权限，请打开下载权限后再试！",showCancel:!1,success:function(n){n.confirm&&e.openSetting({success:function(n){n.authSetting["scope.writePhotosAlbum"]?e.saveImageToPhotosAlbum({filePath:t.saveUrl,success:function(n){e.hideLoading(),t.adShow=!0}}):e.showModal({title:"温馨提示",content:"授权失败，请稍后重新获取",showCancel:!1})}})}}),e.hideLoading()}})},adClick:function(){o&&o.show().catch((function(e){o.load().then((function(){return o.show()}))}))},adLoad:function(){var e=this;wx.createRewardedVideoAd&&(o=wx.createRewardedVideoAd({adUnitId:"adunit-8b7aecba30b3f324"}),o.onError((function(e){console.log("videoAd onError",res)})),o.onClose((function(n){e.designShow=!1,n&&n.isEnded||void 0===n?e.vuex_user&&e.userIntegral():console.log("中途退出")})))},userIntegral:function(){var n=this;return u(i.default.mark((function t(){var s,r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return s=n,e.showLoading({mask:!0,title:"正在拼命加载中..."}),t.next=4,a.callFunction({name:"user_integral",data:{userId:s.vuex_user._id}});case 4:r=t.sent,e.hideLoading(),r.result.success&&(s.getUser(),s.signTitle="<p style='font-weight: 550;font-size: 16px;'>观看成功</p><p style='padding-top: 10px;'>获得<span class='num'>"+r.result.integral+"</span>积分</p>",s.signShow=!0);case 7:case"end":return t.stop()}}),t)})))()},getUser:function(){var e=this;return u(i.default.mark((function n(){var t,s;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,a.callFunction({name:"query_map",data:{dbName:"wx_user",id:t.vuex_user._id}});case 3:s=n.sent,t.$u.vuex("vuex_user",s.result);case 5:case"end":return n.stop()}}),n)})))()},backClick:function(){e.navigateBack()},viewCont:function(){var e=this;e.viewShow=!e.viewShow},imageUtil:function(e,n){var t=this,a=0,i=0,s={},r=0,u=0,o=n/e,c=t.h/t.w;return o<c?(i=t.h,a=t.h*e/n):(a=t.w,i=t.w*n/e),a>t.w?(r=(a-t.w)/2,r=0-r,u=0):(u=(i-t.h)/2,u=0-u,r=0),s.x=r,s.y=u,s.width=a,s.height=i,s}},onShareAppMessage:function(e){var n=this;return n.adShow=!1,{title:"快来看看我设计的刘海壁纸~",path:"/pages/find/find?userId="+n.vuex_user._id}},onShareTimeline:function(e){return{title:"我等风也等你，近听水无声~",path:"/pages/index/index"}}};n.default=f}).call(this,t("543d")["default"],t("a9ff")["default"])},e97d:function(e,n,t){"use strict";t.r(n);var a=t("c277"),i=t.n(a);for(var s in a)"default"!==s&&function(e){t.d(n,e,(function(){return a[e]}))}(s);n["default"]=i.a}},[["1cee","common/runtime","common/vendor"]]]);