(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/user"],{2751:function(e,n,t){"use strict";t.r(n);var r=t("6bbb"),i=t("415c");for(var a in i)"default"!==a&&function(e){t.d(n,e,(function(){return i[e]}))}(a);t("2a33");var u,o=t("f0c5"),s=Object(o["a"])(i["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],u);n["default"]=s.exports},"2a33":function(e,n,t){"use strict";var r=t("9464"),i=t.n(r);i.a},"415c":function(e,n,t){"use strict";t.r(n);var r=t("b594"),i=t.n(r);for(var a in r)"default"!==a&&function(e){t.d(n,e,(function(){return r[e]}))}(a);n["default"]=i.a},"4e9e":function(e,n,t){"use strict";(function(e){t("acd6");r(t("66fd"));var n=r(t("2751"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},"6bbb":function(e,n,t){"use strict";t.d(n,"b",(function(){return i})),t.d(n,"c",(function(){return a})),t.d(n,"a",(function(){return r}));var r={uIcon:function(){return t.e("uview-ui/components/u-icon/u-icon").then(t.bind(null,"df57"))}},i=function(){var e=this,n=e.$createElement;e._self._c;e._isMounted||(e.e0=function(n){e.loginShow=!1},e.e1=function(n){e.signShow=!1})},a=[]},9464:function(e,n,t){},b594:function(e,n,t){"use strict";(function(e,r){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=a(t("a34a"));function a(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,r,i,a,u){try{var o=e[a](u),s=o.value}catch(c){return void t(c)}o.done?n(s):Promise.resolve(s).then(r,i)}function o(e){return function(){var n=this,t=arguments;return new Promise((function(r,i){var a=e.apply(n,t);function o(e){u(a,r,i,o,s,"next",e)}function s(e){u(a,r,i,o,s,"throw",e)}o(void 0)}))}}var s=null,c={};c=e.getMenuButtonBoundingClientRect();var l=function(){t.e("components/fooBar/fooBar").then(function(){return resolve(t("e7fc"))}.bind(null,t)).catch(t.oe)},d=function(){t.e("components/model/model").then(function(){return resolve(t("430a"))}.bind(null,t)).catch(t.oe)},f={components:{fooBar:l,models:d},data:function(){return{menuButtonInfo:c,loadShow:!0,isSign:!1,signShow:!1,signTitle:"",signIntegral:0,inviteIntegral:0,adIntegral:0,writeShow:!1,loginShow:!1}},onLoad:function(){var n=this;return o(i.default.mark((function t(){var r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.hideTabBar(),r=n,t.next=4,r.getConfig();case 4:r.vuex_user&&r.getUser(),r.loadShow=!1,r.adLoad();case 7:case"end":return t.stop()}}),t)})))()},onShow:function(){var e=this;return o(i.default.mark((function n(){var t;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:t=e,t.vuex_user&&t.getSign();case 2:case"end":return n.stop()}}),n)})))()},methods:{toIndex:function(n){var t=this;return o(i.default.mark((function r(){var a;return i.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=t,a.index=n,0==n?e.switchTab({url:"/pages/index/index"}):1==n?e.switchTab({url:"/pages/center/center"}):2==n&&e.switchTab({url:"/pages/find/find"});case 3:case"end":return r.stop()}}),r)})))()},loginClick:function(){this.vuex_user||(this.loginShow=!0)},signClick:function(){var n=this;return o(i.default.mark((function t(){var a,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=n,a.vuex_user){t.next=4;break}return a.loginShow=!0,t.abrupt("return");case 4:if(!a.isSign){t.next=6;break}return t.abrupt("return");case 6:return e.showLoading({mask:!0,title:"签到中..."}),t.next=9,r.callFunction({name:"sign_add",data:{userId:a.vuex_user._id}});case 9:u=t.sent,e.hideLoading(),u.result.success?(a.getUser(),a.signTitle="<p style='font-weight: 550;font-size: 16px;'>签到成功</p><p style='padding-top: 10px;'>获得<span class='num'>"+u.result.integral+"</span>积分</p>",a.signShow=!0,a.isSign=!0):e.showToast({icon:"none",mask:!0,title:u.result.msg,duration:1500});case 12:case"end":return t.stop()}}),t)})))()},recordClick:function(){this.vuex_user?e.navigateTo({url:"/pages/integral/record"}):this.loginShow=!0},gonggaoClick:function(){this.vuex_user?e.navigateTo({url:"/pages/about/gonggao"}):this.loginShow=!0},taskClick:function(){this.vuex_user?e.navigateTo({url:"/pages/integral/task"}):this.loginShow=!0},paihangClick:function(){this.vuex_user?e.navigateTo({url:"/pages/list/list?type=ranking&pid=&id=hot"}):this.loginShow=!0},modelSave:function(){this.vuex_user?this.modelShow=!1:this.loginShow=!0},collectClick:function(){this.vuex_user?e.navigateTo({url:"/pages/collect/collect"}):this.loginShow=!0},orderClick:function(){this.vuex_user?e.navigateTo({url:"/pages/order/order"}):this.loginShow=!0},writeClick:function(){this.vuex_user?e.navigateTo({url:"/pages/write/write"}):this.loginShow=!0},exitClick:function(){var n=this;e.showModal({title:"温馨提示",content:"确定退出当前登录账户？",confirmText:"退出",confirmColor:"#fcc600",success:function(){var e=o(i.default.mark((function e(t){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.confirm&&(n.$u.vuex("vuex_user",""),n.isSign=!1);case 1:case"end":return e.stop()}}),e)})));function t(n){return e.apply(this,arguments)}return t}()})},cacheClick:function(){var n=this;e.showModal({title:"温馨提示",content:"清除缓存后请重新登录！",confirmText:"确定",confirmColor:"#fcc600",success:function(){var e=o(i.default.mark((function e(t){return i.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.confirm&&(n.$u.vuex("vuex_user",""),n.isSign=!1);case 1:case"end":return e.stop()}}),e)})));function t(n){return e.apply(this,arguments)}return t}()})},aboutClick:function(){e.navigateTo({url:"/pages/about/about"})},feedClick:function(){this.vuex_user?e.navigateTo({url:"/pages/feed/feed"}):this.loginShow=!0},systemClick:function(){e.navigateTo({url:"/pages/system/system"})},getUser:function(){var e=this;return o(i.default.mark((function n(){var t,a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,r.callFunction({name:"query_map",data:{dbName:"wx_user",id:t.vuex_user._id}});case 3:a=n.sent,t.$u.vuex("vuex_user",a.result);case 5:case"end":return n.stop()}}),n)})))()},getSign:function(){var e=this;return o(i.default.mark((function n(){var t,a,u,o;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,a=new Date((new Date).toLocaleDateString()).getTime(),u=new Date((new Date).toLocaleDateString()).getTime()+864e5-1,n.next=5,r.callFunction({name:"sign_flag",data:{dbName:"wx_sign",userId:t.vuex_user._id,startTime:a,endTime:u}});case 5:o=n.sent,o.result.success?t.isSign=!0:t.isSign=!1;case 7:case"end":return n.stop()}}),n)})))()},getConfig:function(){var e=this;return o(i.default.mark((function n(){var t,a;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,n.next=3,r.callFunction({name:"config_map",data:{keys:["signIntegral","inviteIntegral","adIntegral","writeShow"]}});case 3:a=n.sent,a.result.success&&(t.signIntegral=parseInt(a.result.data[0]),t.inviteIntegral=parseInt(a.result.data[1]),t.adIntegral=parseInt(a.result.data[2]),t.writeShow=a.result.data[3]);case 5:case"end":return n.stop()}}),n)})))()},adClick:function(){var e=this;e.vuex_user?s&&s.show().catch((function(e){s.load().then((function(){return s.show()}))})):e.loginShow=!0},adLoad:function(){var e=this;wx.createRewardedVideoAd&&(s=wx.createRewardedVideoAd({adUnitId:"{{ excitation }}"}),s.onError((function(e){console.log("videoAd onError",e)})),s.onClose((function(n){n&&n.isEnded||void 0===n?e.vuex_user&&e.userIntegral():console.log("中途退出")})))},userIntegral:function(){var n=this;return o(i.default.mark((function t(){var a,u;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=n,e.showLoading({mask:!0,title:"正在拼命加载中..."}),t.next=4,r.callFunction({name:"user_integral",data:{userId:a.vuex_user._id}});case 4:u=t.sent,e.hideLoading(),u.result.success&&(a.getUser(),a.signTitle="<p style='font-weight: 550;font-size: 16px;'>观看成功</p><p style='padding-top: 10px;'>获得<span class='num'>"+u.result.integral+"</span>积分</p>",a.signShow=!0);case 7:case"end":return t.stop()}}),t)})))()},getUserInfo:function(){var n=this;e.getUserProfile({desc:"个人登录，记录数据",success:function(e){console.log(e),n.name="逸动潮图",n.avatar=e.userInfo.avatarUrl,n.wxlogin()},fail:function(){console.log("获取用户信息失败")}})},wxlogin:function(){var n=this;return o(i.default.mark((function t(){var r;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=n,e.showLoading({title:"登录中..."}),e.login({provider:"weixin",success:function(e){var n=e.code;r.wxloginres(n)}});case 3:case"end":return t.stop()}}),t)})))()},wxloginres:function(n){var t=this;return o(i.default.mark((function a(){var u,o,s,c;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return u=t,o=e.getStorageSync("userId"),s="wx",i.next=5,r.callFunction({name:"user_authorize",data:{name:u.name,avatar:u.avatar,mptype:s,code:n,userId:o}});case 5:if(c=i.sent,!c.result.success){i.next=15;break}return u.$u.vuex("vuex_user",c.result.data),u.getUser(),i.next=11,u.getSign();case 11:e.showToast({icon:"none",mask:!0,title:"登录成功",duration:1500}),e.removeStorageSync("userId"),i.next=16;break;case 15:e.showToast({icon:"none",mask:!0,title:c.result.msg,duration:1500});case 16:u.loginShow=!1;case 17:case"end":return i.stop()}}),a)})))()},getLoginShow:function(){var e=this;e.loginShow=!0}},onShareAppMessage:function(e){return{title:"我等风也等你，近听水无声~",path:"/pages/index/index?userId="+this.vuex_user._id}},onShareTimeline:function(e){return{title:"我等风也等你，近听水无声~",path:"/pages/index/index"}}};n.default=f}).call(this,t("543d")["default"],t("a9ff")["default"])}},[["4e9e","common/runtime","common/vendor"]]]);